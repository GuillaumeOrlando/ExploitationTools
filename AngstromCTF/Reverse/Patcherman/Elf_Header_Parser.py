#Simple ELF header parser (64 bits only)

import pathlib
import sys

def read_byte(size, cnt, byte_a, str_a):
    result = ""
    str_result = ""
    tmp_cnt = 0
    while tmp_cnt != size:
        result += str(byte_a[cnt]) + " "
        str_result += str(str_a[cnt])
        tmp_cnt += 1
        cnt += 1
    re = result + " | " + str_result
    return(re, cnt)

file_name = sys.argv[1]
print(file_name)

byte_array = []
str_array = []
cnt = 0

for byte in pathlib.Path(file_name).read_bytes():
    hex_code = "0x%0.2X" % byte
    str_conv = chr(byte)
    byte_array.append(hex_code)
    str_array.append(str_conv)    


e_ident, cnt = read_byte(16, cnt, byte_array, str_array)
e_type, cnt = read_byte(2, cnt, byte_array, str_array)
e_machine, cnt = read_byte(2, cnt, byte_array, str_array)
e_version, cnt = read_byte(2, cnt, byte_array, str_array)
e_entry, cnt = read_byte(8, cnt, byte_array, str_array)
e_phoff, cnt = read_byte(8, cnt, byte_array, str_array)
e_shoff, cnt = read_byte(8, cnt, byte_array, str_array)
e_flag, cnt = read_byte(4, cnt, byte_array, str_array)
e_ehsize, cnt = read_byte(2, cnt, byte_array, str_array)
e_phentsize, cnt = read_byte(2, cnt, byte_array, str_array)
e_phnum, cnt = read_byte(2, cnt, byte_array, str_array)
e_shentsize, cnt = read_byte(2, cnt, byte_array, str_array)
e_shnum, cnt = read_byte(2, cnt, byte_array, str_array)
e_shstrrndx, cnt = read_byte(2, cnt, byte_array, str_array)

print("e_ident: " + e_ident) 
print("e_type: " + e_type)
print("e_machine: " + e_machine)
print("e_version: " + e_version)
print("e_entry: " + e_entry)
print("e_phoff: " + e_phoff)
print("e_shoff: " + e_shoff)
print("e_flag: " + e_flag)
print("e_ehsize: " + e_ehsize)
print("e_phentsize: " + e_phentsize)
print("e_phnum: " + e_phnum)
print("e_shentsize: " + e_shentsize)
print("e_shnum: " + e_shnum)
print("e_shstrrndx: " + e_shstrrndx)
