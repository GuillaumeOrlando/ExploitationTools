# You can install these packages to help w/ solving unless you have others in mind
# i.e. python3 -m pip install {name of package}
from pwn import *
import codecs
from base64 import b64decode
from string import ascii_lowercase

#nc chal.ctf.b01lers.com 2008

HOST = 'chal.ctf.b01lers.com'
PORT = 2008


lookup_table = {'a' : 'z', 'b' : 'y', 'c' : 'x', 'd' : 'w', 'e' : 'v','f' : 'u', 'g' : 't', 'h' : 's', 'i' : 'r', 'j' : 'q', 'k' : 'p', 'l' : 'o', 'm' : 'n', 'n' : 'm', 'o' : 'l', 'p' : 'k', 'q' : 'j', 'r' : 'i', 's' : 'h', 't' : 'g', 'u' : 'f', 'v' : 'e', 'w' : 'd', 'x' : 'c', 'y' : 'b', 'z' : 'a'}

lookup = {'A':'AAAAA', 'B':'AAAAB', 'C':'AAABA', 'D':'AAABB', 'E':'AABAA', 'F':'AABAB', 'G':'AABBA', 'H':'AABBB', 'I':'ABAAA', 'J':'ABAAB', 'K':'ABABA', 'L':'ABABB', 'M':'ABBAA', 'N':'ABBAB', 'O':'ABBBA', 'P':'ABBBB', 'Q':'BAAAA', 'R':'BAAAB', 'S':'BAABA', 'T':'BAABB','U':'BABAA', 'V':'BABAB', 'W':'BABBA', 'X':'BABBB', 'Y':'BBAAA', 'Z':'BBAAB'} 

r = remote(HOST,PORT)

def bacon(message):
    decipher = '' 
    i = 0
    while True : 
        if(i < len(message)-4): 
            substr = message[i:i + 5] 
            if(substr[0] != ' '): 
                decipher += list(lookup.keys())[list(lookup.values()).index(substr)] 
                i += 5 # to get the next set of ciphertext 
            else: 
                decipher += ' '
                i += 1 # index next to the space 
        else: 
            break # emulating a do-while loop 
    return decipher.lower() 

def rot13(s):
    return codecs.decode(s, 'rot13')

def atbash(s): 
    cipher = '' 
    for letter in s:
        # checks for space 
        if(letter != ' '): 
            #adds the corresponding letter from the lookup_table 
            cipher += lookup_table[letter] 
        else: 
            # adds space 
            cipher += ' '
    return cipher 

def Base64(s):
    return base64.b64decode(s)

if __name__ == '__main__':
    count = 0
    while True:     
        r.recvuntil('Method: ')
        method = r.recvuntil('\n').strip()
        r.recvuntil('Ciphertext: ')
        argument = r.recvuntil('\n').strip()
        
        print(method, argument)
        if method.decode('utf-8') == "rot13":
            result = rot13(argument.decode('utf-8'))
            r.recv()
            r.sendline(result.encode())
        elif method.decode('utf-8') == "atbash":
            result = atbash(argument.decode('utf-8'))
            r.recv()
            r.sendline(result.encode())
        elif method.decode('utf-8') == "bacon":
            result = bacon(argument.decode('utf-8'))
            r.recv()
            r.sendline(result.encode())
        else:
            result = Base64(argument.decode('utf-8'))
            r.recv()
            r.sendline(result)
        print("[" + str(count) + "] Result: " + str(result))
        count += 1
        if count == 1000:
            print(r.recv())
            exit(0)
    
